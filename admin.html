<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h2>Panel Admin</h2>
<div id="admin-container"></div>

<script type="module">
import { API_URL, user } from './script.js';

if(!user || user.role!=="admin"){
  alert("Accès refusé");
  window.location.href="index.html";
}

async function loadAdminPanel(){
  try{
    const res = await fetch(`${API_URL}/admin/levels`, { headers: { "Authorization": `Bearer ${user.token}` } });
    const data = await res.json();
    const container = document.getElementById('admin-container');
    container.innerHTML="";
    data.forEach(level=>{
      const div = document.createElement('div');
      div.innerHTML=`
        <h3>${level.title}</h3>
        <p>Créé par : ${level.creator}</p>
        <button class="delete-btn" data-id="${level._id}">Supprimer</button>
      `;
      div.querySelector('.delete-btn').addEventListener('click', async ()=>{
        if(confirm("Supprimer ce niveau ?")){
          await fetch(`${API_URL}/admin/levels/${level._id}`,{
            method:"DELETE",
            headers: { "Authorization": `Bearer ${user.token}` }
          });
          div.remove();
        }
      });
      container.appendChild(div);
    });
  } catch(err){ console.error(err); document.getElementById('admin-container').innerHTML="<p>Erreur serveur</p>"; }
}

loadAdminPanel();
</script>
</body>
</html>
