<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BECT - Admin</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Administration</h1>
<div id="users-list"></div>

<script type="module">
import { API_URL, user } from './script.js';

async function fetchUsers(){
  if(!user||user.role!=='admin'){ alert('AccÃ¨s admin requis'); window.location.href='index.html'; return; }
  try{
    const res = await fetch(`${API_URL}/admin/users`,{
      headers:{ Authorization:`Bearer ${user.token}` }
    });
    const data = await res.json();
    const container = document.getElementById('users-list');
    container.innerHTML='';
    data.users.forEach(u=>{
      const div=document.createElement('div');
      div.innerHTML=`<span>${u.username}</span> <button data-username="${u.username}">Supprimer</button>`;
      div.querySelector('button')?.addEventListener('click', async()=>{
        if(confirm('Supprimer cet utilisateur ?')){
          await fetch(`${API_URL}/admin/users/${u.username}`,{
            method:'DELETE',
            headers:{ Authorization:`Bearer ${user.token}` }
          });
          fetchUsers();
        }
      });
      container.appendChild(div);
    });
  }catch(e){ console.error(e); }
}

fetchUsers();
</script>
</body>
</html>
