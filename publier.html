<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Publier un niveau</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Publier un niveau</h1>
  <form id="publish-form" enctype="multipart/form-data">
    <input type="text" name="title" placeholder="Titre" required>
    <textarea name="description" placeholder="Description"></textarea>
    <input type="file" name="jsonFile" accept=".json" required>
    <input type="file" name="image1" accept="image/*">
    <input type="file" name="image2" accept="image/*">
    <input type="file" name="image3" accept="image/*">
    <button type="submit">Publier</button>
  </form>
  <script type="module">
    import { API_URL, user } from './script.js';

    if(!user) window.location.href="connexion.html";

    document.getElementById("publish-form").addEventListener("submit", async e => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      try {
        const res = await fetch(`${API_URL}/publish`,{
          method:"POST",
          headers: { "Authorization": `Bearer ${user.token}` },
          body: formData
        });
        const data = await res.json();
        if(data.success){
          alert("Niveau publi√© !");
          window.location.href=`niveau.html?id=${data.levelId}`;
        } else alert(data.message);
      } catch(err){
        console.error(err);
        alert("Erreur serveur");
      }
    });
  </script>
</body>
</html>
