<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Publier un niveau - BECT</title>
<link rel="stylesheet" href="style.css">
<style>
Â  body { font-family: Arial, sans-serif; padding: 20px; background: #121212; color: #eee; }
Â  h1 { text-align: center; margin-bottom: 20px; }
Â  form { max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; gap: 12px; background: #1e1e1e; padding: 20px; border-radius: 10px; }
Â  input, textarea, button { padding: 10px; border-radius: 6px; border: none; font-size: 16px; }
Â  input, textarea { background: #2c2c2c; color: #eee; }
Â  button { background: #4caf50; color: white; cursor: pointer; transition: 0.3s; }
Â  button:hover { background: #45a049; }
Â  #msg { text-align: center; margin-top: 10px; font-weight: bold; }
Â  .limit-warning { font-size: 13px; color: #f44336; }
</style>
</head>
<body>

<h1>Publier un niveau</h1>
<p id="username-display" style="text-align:center; margin-bottom:15px;"></p>

<form id="form-publish" onsubmit="return false;">
Â  <input type="text" id="title" placeholder="Titre du niveau (max 10 caractÃ¨res)" required />
Â  <p id="title-warning" class="limit-warning"></p>

Â  <textarea id="description" placeholder="Description du niveau (max 100 caractÃ¨res)" rows="4"></textarea>
Â  <p id="desc-warning" class="limit-warning"></p>

Â  <label>Fichier JSON du niveau :</label>
Â  <input type="file" id="jsonFile" accept=".json" required />

Â  <label>Image 1 (Miniature) :</label>
Â  <input type="file" id="image1" accept="image/*" />
Â  <label>Image 2 :</label>
Â  <input type="file" id="image2" accept="image/*" />
Â  <label>Image 3 :</label>
Â  <input type="file" id="image3" accept="image/*" />

Â  <button id="btn-publish-level" type="button">Publier</button>
Â  <p id="msg"></p>
</form>

<script type="module">
const API_URL = "https://bect-project.onrender.com/api";
let user = JSON.parse(localStorage.getItem("bect_user"));

const usernameDisplay = document.getElementById("username-display");
if(user){
Â  usernameDisplay.textContent = `ConnectÃ© en tant que : ${user.username}`;
} else {
Â  alert("Vous devez Ãªtre connectÃ© pour publier !");
Â  window.location.href = "connexion.html";
}

const btn = document.getElementById('btn-publish-level');
const msg = document.getElementById('msg');

// Ã‰lÃ©ments de saisie
const titleInput = document.getElementById("title");
const descInput = document.getElementById("description");
const titleWarn = document.getElementById("title-warning");
const descWarn = document.getElementById("desc-warning");

// Gestion des limites de caractÃ¨res (inchangÃ©)
titleInput.addEventListener("input", () => {
Â  if (titleInput.value.length > 10) {
Â  Â  titleWarn.textContent = "Le titre ne doit pas dÃ©passer 10 caractÃ¨res.";
Â  Â  titleInput.value = titleInput.value.slice(0, 10);
Â  } else {
Â  Â  titleWarn.textContent = "";
Â  }
});

descInput.addEventListener("input", () => {
Â  if (descInput.value.length > 100) {
Â  Â  descWarn.textContent = "La description ne doit pas dÃ©passer 100 caractÃ¨res.";
Â  Â  descInput.value = descInput.value.slice(0, 100);
Â  } else {
Â  Â  descWarn.textContent = "";
Â  }
});

// ===============================================
// === ğŸš© FONCTION DE VÃ‰RIFICATION MOTS INTERDITS (Liste locale) ===
// ===============================================

/**
 * VÃ©rifie si le texte contient des mots interdits.
 * @param {string} text - Le titre ou la description.
 * @returns {string|null} Le mot interdit trouvÃ©, ou null si tout va bien.
 */
function checkForbiddenWords(text) {
    // Liste de mots vulgaires/explicites
    const forbiddenWords = [
        // FranÃ§ais (FR)
        "pute", "connard", "sexe", "viols", "porn", "nu", "enculÃ©", "viol", 
        "bais", "seins", "couilles", "cul", "salope", "sodomie", "baiser", 
        "branler", "pÃ©nis", "vagin", "nichon", "clitoris", "sperme", "Ã©jaculation",
        "fellatio", "cuni", "masturber", "coÃ¯t", "inceste", "pÃ©dophilie", "zoophilie",
        "drogue", "cocaÃ¯ne", "hÃ©roÃ¯ne", "crack", "cannabis", "meurtre", "tuer",
        "raciste", "nÃ¨gre", "juif", "arabe", "gouine", "pd", "sale", "merde",
        "gros mot", "niquer", "chier", "tabarnak", "hostie",

        // Anglais (EN)
        "milf", "nudes", "fuck", "dick", "pussy", "ass", "tits", "cunt", 
        "whore", "slut", "cock", "vagina", "penis", "nsfw", "sex", "rape", 
        "anal", "bdsm", "faggot", "gay", "lesbian", "weed", "coke", "heroin",
        "shit", "kill", "murder", "nigger", "kike", "pornography", "blowjob",
        "jizz", "cumshot", "gangbang", "incest", "child abuse", "pedo", "zoophile",
        "groping", "molest", "bitch", "douchebag", "goddamn", "asshole",

        // Espagnol (ES)
        "puta", "joder", "coÃ±o", "culo", "pene", "vagina", "mierda", "cabrÃ³n",
        "chingar", "teta", "pollas", "gilipollas", "maricÃ³n", "violar", "follar",

        // Italien (IT)
        "cazzo", "figa", "puttana", "troia", "merda", "stronzo", "frocio",
        "scopare", "vaffanculo", "coglione", "sesso", "violenza",

        // Allemand (DE)
        "fotze", "wichser", "arschloch", "schwanz", "muschi", "ficken",
        "scheiÃŸe", "vergewaltigung", "hure", "nutte", "titten", "schwul",

        // Portugais (PT)
        "puta", "caralho", "fodase", "pica", "cu", "bosta", "violar",
        "foder", "buceta", "porra", "chupar", "vagabunda",

        // Acronymes et termes supplÃ©mentaires
        "nsfw", "milf", "bdsm", "hentai", "sexo", "guro", "snuff", "gore", "lolicon",
        "shota", "drugs", "4chan", "gore", "loli"
    ];
    
    // Normalise le texte pour la recherche
    const normalizedText = text.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");
    const words = normalizedText.split(/\s+/).filter(word => word.length > 2); // Filtre les mots trop courts

    for (const word of words) {
        if (forbiddenWords.includes(word)) {
            return word;
        }
    }
    return null;
}

// === Envoi du formulaire ===
btn.addEventListener('click', async ()=>{
Â  let title = titleInput.value.trim();
Â  let description = descInput.value.trim();
Â  const jsonFile = document.getElementById("jsonFile").files[0];
Â  const img1 = document.getElementById("image1").files[0];
Â  const img2 = document.getElementById("image2").files[0];
Â  const img3 = document.getElementById("image3").files[0];

Â  // --- VÃ‰RIFICATIONS BASIQUES ---
Â  if(!title || !jsonFile){
Â  Â  msg.style.color = "#f44336";
Â  Â  msg.textContent = "Veuillez fournir un titre et un fichier JSON.";
Â  Â  return;
Â  }
Â  if(!img1 && !img2 && !img3){
Â  Â  msg.style.color = "#f44336";
Â  Â  msg.textContent = "Vous devez ajouter au moins une image.";
Â  Â  return;
Â  }
Â  if (title.length > 10 || description.length > 100) {
Â  Â  msg.style.color = "#f44336";
Â  Â  msg.textContent = "Erreur de taille (titre max 10, description max 100).";
Â  Â  return;
Â  }

  // --- VÃ‰RIFICATION MOTS INTERDITS ---
  const forbiddenTitle = checkForbiddenWords(title);
  const forbiddenDesc = checkForbiddenWords(description);

  if (forbiddenTitle) {
      msg.style.color = "#f44336";
      msg.textContent = `Titre refusÃ© : Le mot "${forbiddenTitle}" n'est pas autorisÃ©.`;
      return;
  }
  
  if (forbiddenDesc) {
      msg.style.color = "#f44336";
      msg.textContent = `Description refusÃ©e : Le mot "${forbiddenDesc}" n'est pas autorisÃ©.`;
      return;
  }
  // ------------------------------------

  // â— NOTA BENE : La vÃ©rification d'image -18 doit Ãªtre effectuÃ©e sur le serveur.
  // Si le serveur (Render) dÃ©tecte une image -18 via son propre appel Ã  une API d'IA, 
  // il DOIT rÃ©pondre par une erreur (par exemple, code 403 ou 400 avec un message JSON).

Â  const formData = new FormData();
Â  formData.append("title", title);
Â  formData.append("description", description);
Â  formData.append("jsonFile", jsonFile);
Â  if(img1) formData.append("image1", img1);
Â  if(img2) formData.append("image2", img2);
Â  if(img3) formData.append("image3", img3);

Â  msg.style.color = "#fff";
Â  msg.textContent = "Envoi et vÃ©rification du contenu en cours...";

Â  try{
Â  Â  const res = await fetch(`${API_URL}/publish`, {
Â  Â  Â  method: "POST",
Â  Â  Â  headers: { "Authorization": `Bearer ${user.token}` },
Â  Â  Â  body: formData
Â  Â  });
Â  Â  const data = await res.json();

Â  Â  if(data.success){
Â  Â  Â  msg.style.color = "#4caf50";
Â  Â  Â  msg.textContent = "Niveau publiÃ© avec succÃ¨s ! (VÃ©rification d'image passÃ©e si implÃ©mentÃ©e sur le serveur)";
Â  Â  Â  document.getElementById('form-publish').reset();
Â  Â  Â  titleWarn.textContent = "";
Â  Â  Â  descWarn.textContent = "";
Â  Â  } else {
Â  Â  Â  msg.style.color = "#f44336";
Â  Â  Â  // Le message peut venir du serveur s'il a bloquÃ© l'image
Â  Â  Â  msg.textContent = data.message || "Erreur lors de la publication ou vÃ©rification d'image Ã©chouÃ©e (si implÃ©mentÃ©e).";
Â  Â  }
Â  } catch(err){
Â  Â  console.error(err);
Â  Â  msg.style.color = "#f44336";
Â  Â  msg.textContent = "Erreur serveur (vÃ©rifie la console pour les dÃ©tails)";
Â  }
});
</script>

</body>
</html>